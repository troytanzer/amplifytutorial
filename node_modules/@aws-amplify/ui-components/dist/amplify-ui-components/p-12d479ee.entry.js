import{r as t,h as i}from"./p-73696195.js";import{Logger as e,I18n as r,filenameToContentType as s}from"@aws-amplify/core";import{A as o}from"./p-f199eef0.js";import{T as a}from"./p-15c6ee49.js";import{d as n}from"./p-50fc1c0c.js";import{Storage as m}from"@aws-amplify/storage";import{i as h,c as l,p}from"./p-a473b043.js";var c="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),d=new Uint8Array(16);function f(){if(!c)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return c(d)}for(var y=[],u=0;u<256;++u)y.push((u+256).toString(16).substr(1));function g(t,i,e){var r=(t=t||{}).random||(t.rng||f)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,i){e=e||0;for(var s=0;s<16;++s)i[e+s]=r[s];return i}return function(t){return(y[t[0]]+y[t[1]]+y[t[2]]+y[t[3]]+"-"+y[t[4]]+y[t[5]]+"-"+y[t[6]]+y[t[7]]+"-"+y[t[8]]+y[t[9]]+"-"+y[t[10]]+y[t[11]]+y[t[12]]+y[t[13]]+y[t[14]]+y[t[15]]).toLowerCase()}(r)}const b=new e("S3Album"),v=class{constructor(i){t(this,i),this.contentType="binary/octet-stream",this.level=o.Public,this.picker=!0,this.pickerText=r.get(a.PICKER_TEXT),this.albumItems=[],this.imgArr={},this.list=async()=>{const{path:t="",level:i,track:e,identityId:r}=this;if(b.debug("Album path: "+t),!m||"function"!=typeof m.list)throw new Error(n);try{const s=await m.list(t,{level:i,track:e,identityId:r});this.marshal(s)}catch(s){b.warn(s)}},this.marshal=t=>{t.forEach(t=>{const i=t.key.toLowerCase().split(".")[1];h.has(i)&&(!t.contentType||t.contentType&&"binary/octet-stream"===t.contentType)&&(t.contentType=this.getContentType(t))});const i=t.filter(t=>t.contentType&&t.contentType.startsWith("image/"));let e=this.filter?this.filter(i):i;e=this.sort?this.sort(e):e,this.albumItems=e,b.debug("album items",this.albumItems),this.constructImgArray(this.albumItems)},this.constructImgArray=t=>{t.map(t=>{this.imgArr[""+t.key]=t.key})},this.handlePick=async t=>{const i=t.target.files[0],{path:e="",level:r,track:s,fileToKey:o}=this,a=e+l(i,o);try{await p(a,i,r,s,i.type,b)}catch(n){throw b.error(n),new Error(n)}if(Object.keys(this.imgArr).includes(a))this.albumItems=[...this.albumItems],this.imgArr[a]=`${a}-${g()}`;else{const t=[...this.albumItems,...this.filter?this.filter([{key:a}]):[{key:a}]];this.albumItems=this.sort?this.sort(t):t}}}getContentType(t){return s(t.key,"image/*")}componentWillLoad(){this.list()}render(){return i("div",null,i("div",{class:"album-container"},i("div",{class:"grid-row"},this.albumItems.map(t=>i("div",{class:"grid-item",key:"key-"+t.key},i("amplify-s3-image",{key:this.imgArr[t.key],imgKey:t.key,level:this.level,path:this.path,identityId:this.identityId,track:this.track,handleOnError:this.handleOnError,handleOnLoad:this.handleOnLoad}),i("span",{class:"img-overlay"}))))),this.picker&&i("amplify-picker",{inputHandler:t=>this.handlePick(t),acceptValue:"image/*"}))}};v.style=":host{--overlay-bg-color:rgba(0, 0, 0, 0.15)}.album-container{-webkit-box-sizing:border-box;box-sizing:border-box;max-width:100%;margin:0 auto;padding:0 2rem}.grid-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:-1rem -1rem;padding-bottom:3rem}.grid-item{position:relative;-ms-flex:1 0 22rem;flex:1 0 22rem;-ms-flex-positive:1;flex-grow:1;margin:1rem;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}amplify-s3-image{--width:22rem;--height:20rem;border-radius:5px;-o-object-fit:cover;object-fit:cover}.img-overlay{display:none;width:100%;height:21rem;position:absolute;top:0;left:0;background-color:var(--overlay-bg-color)}.grid-item:hover .img-overlay{display:block}";export{v as amplify_s3_album}